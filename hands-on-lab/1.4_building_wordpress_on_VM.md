# 1.4 Ubuntu 16.04 가상 컴퓨터에 Wordpress 설치

Azure에서는 가상 컴퓨터를 만들 때 정말 쉽게 만들 수 있도록 **생성시 모든 것을 만들 수 있도록** 되어있다. 하지만, 기본적으로 네트워크를 디자인하고, Log를 한 곳에 모으는 것 같이 아키텍처를 그리고 리소스를 만드려면 앞서 진행한 `1.1과 1.3`의 작업이 선행 되어야 보다 쉽게 아키텍처에 그려진 대로 서비스를 구축할 수 있다.

이번 내용에서는 Azure에 Ubuntu 16.04를 만들 때 가용성 집합을 사용하고 운영체제 디스크는 관리 디스크를 사용하여 만들어 본다. 가상 컴퓨터를 만든 후 Wordpress를 구성하는 스크립트를 실행한다.

가상 컴퓨터(VM)에 대해 좀 더 상세히 알아보고 싶으신 분은 [Azure Linux 가상 컴퓨터 문서](https://docs.microsoft.com/ko-kr/azure/virtual-machines/linux/)를 참고한다.

## Custom Script For Linux를 사용하는 Ubuntu 16.04 가상 컴퓨터 만들기

1. [Azure 웹 콘솔](https://portal.azure.com)에 접속한다.

2. 좌측 메뉴에서 **리소스 만들기**를 클릭한다.

3. **새로 만들기** 블레이드 창이 뜨면 상단의 검색창에 `ubuntu 16.04`를 입력한 후 엔트키를 입력한다.

4. 검색된 화면에서 `Ubuntu Server 16.04 LTS`를 찾아 클릭한다. 클릭하기 전 **게시자** 컬럼에 `Canonical`로 되어있는지 다시 한 번 확인하자.

5. **Ubuntu Server 16.04 LTS** 블레이드 창이 뜨면 가볍게 내용을 확인한 후 하단에 **배포 모델 선택**을 **Resource Manager**로 선택한 후 **만들기**버튼을 클릭한다.

6. **가상 머신 만들기** 블레이드 창이 뜨면 **1. 기본 사항**부터 **4. 요약**까지 메뉴가 나오며 각 단계별 설정할 수 있는 블레이드 창이 뜬다.
    > [!메모]
    >
    > **가상 컴퓨터 만들기** 블레이드에 나오는 **1. 기본 사항**부터 **4. 요약** 까지의 내용은 언제든 선택하여 이동하실 수 있다.

7. **기본 사항**에 대해서는 아래와 같이 입력한 후 **확인**버튼을 클릭한다.
    - `이름`: 표시 될 가상 컴퓨터 이름을 입력한다. 여기서는 `krazure-wp`를 입력한다.
    - `VM 디스크 유형`: **SSD**는 프리미엄 저장소를 뜻하며, **HDD**는 일반 저장소를 뜻한다. 여기서는 **SSD**를 선택한다.
    - `사용자 이름`: Linux에 로그인 할 계정을 입력한다. 여기서는 `krazure`를 입력한다.
    - `인증 형식`: **SSH 공개 키** 또는 **암호**방식의 로그인을 선택한다. 여기서는 **SSH 공개 키**를 선택한다.
    - `SSH 공개 키`: 공개키 파일의 내용을 입력한다. SSH 공개키를 만드는 방법을 모르면 [여기](../source/key-pair/vm_publickey.pem)를 참고하여 공개키를 입력한다.
    - `Azure Active Directory를 사용하여 로그인(미리 보기)`: AAD 계정을 이용하여 OS에 로그인 하는 설정이다. 여기서는 **사용 안 함**을 선택한다.
    - `구독` : 가상 컴퓨터를 생성할 구독을 선택한다.
    - `리소스 그룹` : 가상 컴퓨터를 만들 리소스 그룹을 선택한다. **기존 그룹 사용**을 선택한 후 앞서 생성한 `krazure-rg`를 선택한다.
    - `위치` : 가상 컴퓨터를 생성할 지역을 선택한다. 여기서는 `아시아 남동부`를 선택한다.

8. `크기` 블레이드 창이 뜨면 원하는 가상 컴퓨터 크기를 선택한 후 하단의 **선택**을 클릭한다. 여기서는 `B1ms`을 선택한다.

9. `설정` 블레이드 창이 뜨면 아래와 같이 입력한 후 **확인**버튼을 클릭한다.
    - `가용성 영역`: 가용성 영역을 사용할 시 선택한다. 여기서는 가용성 집합을 사용할 것이기 때문에 **없음**을 선택한다.
    - `가용성 집합`: 가상 컴퓨터의 가용성 집합을 설정한다. **없음**을 클릭하면 **가용성 집합 변경** 블레이드 창이 뜬다. 여기에서 **새로 만들기**를 클릭하고 아래와 같이 입력한 후 하단에 **확인**을 클릭한다.
        - `이름`: 표시 될 가용성 집합의 이름을 입력한다. 여기서는 `krazure-as`로 입력한다.
        - `장애 도메인`: 설정할 장애 도메인의 개수 이다. 기본 값을 사용한다.
        - `업데이트 도메인`: 설정할 업데이트 도메인 이다. 기본 값을 사용한다.
        - `관리 디스크 사용`: 자동으로 설정된다.
            > [!메모]
            >
            > 가용성 집합은 관리 디스크의 사용 여부에 따라 다르게 적용된다. 예를 들어 가용성 집합이 관리 디스크를 사용하도록 설정한 후 만들게 되면, 관리 디스크를 사용하지 않는 가상 컴퓨터는 해당 가용성 집합에 포함 될 수 없다.
    - `관리 디스크 사용`: **관리 디스크**를 사용할 시 선택한다. 여기서는 **예**를 선택한다.
    - `OS 디스크 크기`: 가상 컴퓨터의 OS용량을 선택한다. 여기서는 기본 값을 사용한다.
    - `가상 네트워크`: 가상 컴퓨터의 **네트워크 인터페이스**가 연결 될 가상 네트워크를 선택한다. 앞서 생성한 `krazure-vnet`을 선택한다.
    - `서브넷`: 가상 컴퓨터의 **네트워크 인터페이스**가 연결 될 서브넷를 선택한다. 앞서 생성한 `krazure-subnet`을 선택한다.
    - `공용 IP 주소`: Public IP가 필요할 시 설정한다. 여기서는 **공용 IP 주소**를 **동적**으로 설정한다.
        - `이름`: 표시될 **공용 IP 주소**의 이름이다. 여기서는 `krazure-wp-ip`를 입력한다.
        - `SKU`: 공용 IP의 SKU를 선택한다. `가용성 영역`을 사용하지 않기 때문에 **기본**을 선택한다.
        - `할당`: 공용 IP를 동적으로 할당 받을지 정적으로 할당 받을지를 선택한다. 여기서는 **동적**으로 선택한다.
        > [!메모]
        >
        > **동적**할당은 가상 컴퓨터가 꺼졌다가 켜질 때 마다 공인 IP를 새롭게 받아온다.
        >
        > **정적**할당은 가상 컴퓨터가 꺼졌다가 켜지더라고 공인 IP가 변경되지 않는다.
    - `네트워크 보안 그룹`: 가상 컴퓨터의 네트워크 인터페이스에 연결될 **네트워크 보안 그룹**을 지정할 유형을 선택한다. 여기서는 **기본**을 선택한다.
    - `공용 인바운드 포트 선택`: 앞서 네트워크 보안 그룹을 **기본**으로 설정할 시 네트워크 보안 그룹을 쉽게 설정해 주는 옵션이다. 드롭다운 메뉴를 클릭하여 **HTTP**와 __SSH (22)__ 를 선택한다.
    - `확장`: 가상 컴퓨터를 만들 때 사용할 확장 기능을 선택한다. 대부분이 제품을 설치하는 옵션이며, 최초 가상 컴퓨터 생성 시 실행해야 할 스크립트를 지정할 수 있다. 여기서는 확장 기능을 사용할 것이기 때문에 **확장 없음**을 클릭한 후 아래와 같은 작업을 진행한다.
        - **확장** 블레이드가 추가로 뜨면 **확장 추가**라는 글씨를 클릭한다.
        - **새 리소스** 블레이드가 추가로 뜨면 **Custom Script For Linux**를 찾아 클릭한다.
        - **Custom Script For Linux** 블레이드가 추가로 뜨면 하단에 **만들기**버튼을 클릭한 후 아래와 같이 입력한 후 하단에 **확인**버튼을 클릭한다.
            - `Script files`: Linux에서 실행할 스크립트 파일을 첨부한다. [여기](https://raw.githubusercontent.com/krazure/workshop-itpro-101/master/source/script/init.sh)를 클릭한 후 웹 페이지가 뜨면 마우스 우클릭 -> 다른 이름으로 저장(A)...을 클릭하여 `init.sh` 파일로 저장하고, 저장한 `init.sh` 파일을 첨부한다.
            - `Command`: Linux에서 실행할 명령어를 입력한다. 앞서 `Script files`에서 지정한 파일을 실행하기 위해 `sh init.sh`를 입력한다.
        - **확장** 블레이드에 **Custom Script For Linux**가 추가되면 하단에 **확인**버튼을 클릭한다.
    - `자동 종료 사용`: 가상 컴퓨터를 지정한 시각에 종료하는 추가 옵션이다. 여기서는 **끄기**를 선택한다.
    - `부트 진단`: 가상 컴퓨터가 부팅될 때 로그를 생성할 수 있다. 실제 서비스 시에 해당 옵션이 꺼져 있으면 문제 추적에 어려움이 있을 수 있어 **사용하는 것이 권장**이다. 여기서는 **사용 안 함**을 선택한다.
    - `게스트 OS 진단`: 가상 컴퓨터의 운영체제의 문제에 대한 추적을 할 수 있도록 로그를 생성할 수 있다. 실제 서비스 시에 해당 옵션이 꺼져 있으면 문제 추적에 어려움이 있을 수 있어 **사용하는 것이 권장**이다. 여기서는 **사용 안 함**을 선택한다.
    - `진단 저장소 계정`: 위의 `부트 진단`과 `게스트 OS 진단` 옵션 중 하나라도 **사용**할 시 활성화가 된다. 디스크가 저장되는 **저장소 계정**을 사용할 수 없으며, **프리미엄 저장소**도 사용할 수 없다.
        > [!메모]
        >
        > `저장소 계정`에서 설명한 것과 같이 배치 작업을 수행할 때 문제가 될 수 있다.
    - `Azure Active Directory에 등록`: AAD에 VM을 등록할 때 사용한다. 여기서는 **아니오**를 선택한다.
    - `백업`: 가상 컴퓨터를 백업하는 옵션이다. 여기서는 **사용 안 함**을 선택한다.

10. **요약** 블레이드가 뜨면 지금까서 설정한 설정들을 확인하고 하단에 **확인** 버튼을 클릭하여 **가상 컴퓨터**를 만든다.
    > [!메모]
    >
    > 상단에 **유효성 검사 통과**가 나올 시 가상 컴퓨터를 생성할 수 있으며 만약 다른 메세지가 나오게 된다면 **제한 사항**에 문제가 있을 수 있다. **제한 사항**에 대해서는 다음 [URL](https://docs.microsoft.com/ko-kr/azure/azure-subscription-service-limits#networking-limits)을 참고한다.